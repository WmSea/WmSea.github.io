<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8" />
  
  <title>DIY个人FTP Fuzzer | BootKit&#39;s Blog</title>
  <meta name="author" content="BootKit" />

  
  <meta name="description" content="Diy个人ftp fuzzer0x00介绍本文旨在通过python以及C#构造用户能够自定义，添加或者修改挖掘规则的ftp fuzzer。现在很多的ftp fuzzer已经由开发者自定义了内部挖掘规则。如果需要加入新的挖掘规则，用户除了自己写一个挖掘器，是否还有其它方法呢？  
实现方式：由ftp " />
  

  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

  <meta property="og:title" content="DIY个人FTP Fuzzer" />
  <meta property="og:site_name" content="BootKit&#39;s Blog" />

  
  

  
    <meta property="og:image" content="undefined" />
  

  
  <link href="/css/images/favicon.ico" rel="icon" />
  

  <link rel="alternate" href="/atom.xml" title="BootKit&#39;s Blog" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  


  <!-- baidu webmaster push -->
  <script src='//push.zhanzhang.baidu.com/push.js'></script>

</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">BootKit&#39;s Blog</a></h1>
  <h2><a href="/">穷尽一生磨利剑            ----BootKit</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">主页</a></li>
    
      <li><a href="/archives">归档</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-09-27T04:52:58.000Z"><a href="/2016/09/27/DIY个人FTP Fuzzer/">2016-09-27</a></time>
      
      
  
    <h1 class="title">DIY个人FTP Fuzzer</h1>
  

    </header>
    <div class="entry">
      
        <h2 id="Diy个人ftp-fuzzer"><a href="#Diy个人ftp-fuzzer" class="headerlink" title="Diy个人ftp fuzzer"></a>Diy个人ftp fuzzer</h2><h3 id="0x00介绍"><a href="#0x00介绍" class="headerlink" title="0x00介绍"></a>0x00<strong><em>介绍</em></strong></h3><p>本文旨在通过python以及C#构造用户能够自定义，添加或者修改挖掘规则的ftp fuzzer。<br>现在很多的ftp fuzzer已经由开发者自定义了内部挖掘规则。如果需要加入新的挖掘规则，用户除了自己写一个挖掘器，是否还有其它方法呢？  </p>
<p>实现方式：由ftp fuzzer提供接口，用户按照自己的想法写出相应的挖掘规则。</p>
<p>环境:WIn8 vs2013 + python + ironPython</p>
<h3 id="0x01详概"><a href="#0x01详概" class="headerlink" title="0x01详概"></a>0x01<strong><em>详概</em></strong></h3><p>ftp相关知识这里不介绍，大家可以去看看官方文档。程序整体的界面用c#开发，其中ironPython是为了实现在c#环境下运行python脚本。用python的原因主要基于：1.用户可以专注于挖掘规则的编写，不需要关注界面，以及数据处理问题。2.python简单，快捷，学习进度快。  </p>
<p>在C#中调用python文件需要用到ironPython技术。相关资料读者可自行查阅，这里就不过多介绍了。  </p>
<p>相关的调用方式：</p>
<pre><code>//c#中调用python脚本
using IronPython.Hosting;
.......
ScriptRuntime pyRuntime = Python.CreateRuntime();
dynamic obj = pyRuntime.UseFile(&quot;fuzz.py&quot;); //创建python脚本对象 使用方法：obj.function()
</code></pre><p>fuzz.py文件包含各种测试命令，脏数据，以及规则。这些都可以由用户修改，添加。<br>C#调用fuuz.py文件中的函数向ftp服务器发送各种脏数据。<br>测试之前我们肯定也要看ftp服务是否打开，这里我们用一个简单的函数完成。  </p>
<pre><code>def login(ip, port, username, password):
    s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
    try:
        connect = s.connect((ip, port))
        s.recv(1024)
        s.send(&quot;user &quot; + username + &quot;\r\n&quot;)
        s.recv(1024)
        s.send(&quot;PASS &quot; + password + &quot;\r\n&quot;)
        s.recv(1024)
        s.close()
        return True;
    except:
        s.close()
        return False;
</code></pre><p>介绍程序之前我们首先看一下当前常用ftp fuzzer是如何对程序进行测试的。  </p>
<pre><code>buffer = 50*&apos;A&apos;
s.send(fuzzcmd[attr] + &quot; &quot; + buffer * 5 + &apos;\r\n&apos;)
s.send(fuzzcmd[attr] + &quot; &quot; + buffer * 20 + &apos;\r\n&apos;)
s.send(fuzzcmd[attr] + &quot; &quot; + buffer * 40 + &apos;\r\n&apos;)
s.send(fuzzcmd[attr] + &quot; &quot; + buffer * 100 + &apos;\r\n&apos;)
s.send(fuzzcmd[attr] + &quot; &quot; + buffer * 200 + &apos;\r\n&apos;)
来源：《0day安全软件漏洞分析技术》
</code></pre><p>fuzzcmd是一个包含ftp命令的数组，如“cd” “dir”等等。</p>
<p>我们定义一个overFuzz()函数，来完成这个功能。</p>
<pre><code>def overFuzz(ip, port, username, password, attr)  
</code></pre><p>按照这种方式，ftp服务器接收到的数据如果造成溢出，程序将直接崩溃掉，程序崩溃掉之后，数据自然是发送不到ftp服务器的，我们可以按照这个依据来判断程序是否含有漏洞。</p>
<pre><code>attr = &quot;标志位&quot; + &quot;脏数据&quot;
</code></pre><p>c#判断attr其中的标志位是否为“true”，如果为“true”,则后面的脏数据则为造成程序崩溃的数据，可以供用户后面分析调试。</p>
<p>可利用的漏洞我们用这种方法测试，而不能利用，只能造成程序异常退出的漏洞我们将采用另外一种规则。在fuzz.py中，我们定义了dDosString[], dDosChar[]两个数组，用户有自己的想法，也完全可以修改这两个变量。测试方式和前面的overfuzz一样。</p>
<p>现在我们用某个ftp服务程序测试一下。这是其中关于ddos的测试效果。</p>
<p><img src="/img/1.jpg" alt="1 icon"></p>
<p><img src="/img/2.jpg" alt="2 icon"></p>
<p>当然这个漏洞不能利用，只能造成程序异常退出。</p>
<p>现在我们再看一下挖掘规则的问题。在fuzz.py文件中，现在我们定义了几个重要的变量。</p>
<pre><code>fuzzcmd[] //包含ftp命令
buffer = 50*&apos;a&apos; 
dDosString[] //例如&apos;%%%n&apos;
dDosChar[] //例如&apos;%&apos;， &apos;\&apos;等
</code></pre><p>这几个变量的值由用户决定。在文章开头，我们说过新的挖掘规则怎么添加？我们完全可以仿照overFuzz这个函数重新写一个，恩，我们试一下。观察一下我们发送数据的格式。 </p>
<pre><code>s.send(fuzzcmd[attr] + &quot; &quot; + buffer * 5 + &apos;\r\n&apos;)
</code></pre><p>发送的数据都是像这样的：</p>
<pre><code>cd aaaaaaaaaaaaaaaaaaaaaaaaa &apos;\r\n&apos;
</code></pre><p>这也是大多数此类fuzz程序通用的格式，现在有一种新的方式，且程序中招率还不低，我测试了市面上大多ftp服务端程序，其中部分程序在处理以下数据的时候，将直接退出。</p>
<pre><code>s.send(fuzzcmd[attr] + &quot; &quot; + buffer * 5) //命令后面加字符串 不添加&apos;\r\n&apos;
s.send(fuzzcmd[attr])                    //命令后面不加字符串 不添加&apos;\r\n&apos;
</code></pre><p>虽然只是后面有没有’\r\n’的问题，但是很多ftp服务端程序依然没有处理此种数据的能力。<br>(其实你也可以尝试把’\r\n’删除，添加或者在两个’\r\n’中添加其它数据，有惊喜！)  </p>
<p>如：  </p>
<pre><code>&apos;cd&apos; + &apos;a&apos;*500 + &apos;\r\n&apos; + &apos;a&apos;*500 + &apos;\r\n&apos; //&apos;\r\n&apos;可以修改成其它类似的数据
</code></pre><h3 id="0x02总结"><a href="#0x02总结" class="headerlink" title="0x02总结"></a>0x02<strong><em>总结</em></strong></h3><p>文章只是介绍了ftp fuzzer的小部分知识，还有很多东西文中都没有提到，包括ftp的基础知识，溢出的相关知识。这些读者都可以自己去查找相关资料，当然，这也不是本文关注的重点。希望大家能够发挥各自脑洞，不要让现有的资料或者规则局限思维方式。在ftp漏洞挖掘中，就我所知道的，挖掘ftp漏洞至少还有一种规则。文章中介绍的fuzzer其貌不全，但是在添加了大多数规则的时候，测试效果还是较好的。大多ftp服务端程序或多或少都有问题。希望大家能在这个简单模型的基础上，打造一个功能强大的ftp fuzzer。</p>

      
    </div>
    
    <footer>
        <div class="alignright">
          
          <a href='javascript:void(0)' class="share-link bdsharebuttonbox" data-cmd="more">分享</a>
        </div>
        
        
        <!-- partial('post/share') -->
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="搜索">
    <input type="hidden" name="q" value="site:yoursite.com">
  </form>
</div>

  

  
<div class="widget tag">
  <h3 class="title">最新文章</h3>
  <ul class="entry">
    
      <li>
        <a href="/2016/09/27/DIY个人FTP Fuzzer/">DIY个人FTP Fuzzer</a>
      </li>
    
      <li>
        <a href="/2016/08/17/cve-2010-3333分析/">cve-2010-3333分析</a>
      </li>
    
      <li>
        <a href="/2016/08/17/cve-2012-0158分析/">cve-2012-0158分析</a>
      </li>
    
  </ul>
</div>


  

  
</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  <p>
  
  &copy; 2016 BootKit
  
  All rights reserved.</p>
  <p>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></p>
</div>
<div class="clearfix"></div>

<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"1","bdMiniList":false,"bdPic":"","bdStyle":"2","bdSize":"16"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script></footer>
  <script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


<div id='bg'></div>
</body>
</html>